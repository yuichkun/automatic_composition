var Opmo = require('./Opmo');
var util = require('./util');

class GlobalFile extends Opmo {
  constructor(data){
    super(data);
  }
  generate(){
    var content = "";
    content += this.genUtility();
    content += this.genHarmony();
    super.exportFile(content);
  }
  genUtility(){
    return util;
  }
  genHarmony(){
    var harmony = "";
    var insts = this.content.insts;
    for(var i = 0; i < this.content.time.length; i++){
      // console.log(i, " th measure");
      for(var j = 0; j < Object.keys(insts).length; j++){
        var instName = Object.keys(insts)[j];
        var content = insts[instName][i];
        // console.log("my name is ", instName);
        // console.log("content is ", content);
        harmony += this.handleContent(content);
      }
    }
    return harmony;
  }
  handleContent(content){
    var harmony = "";
    if(content.match("chord")){
      var chordIndex = content.split("-")[1];
      harmony = `(setf harmony${chordIndex} (chordize (integer-to-pitch (rnd-sample 3 (rnd-row)))))\n`;
    }
    return harmony;
  }
}

module.exports = GlobalFile;
