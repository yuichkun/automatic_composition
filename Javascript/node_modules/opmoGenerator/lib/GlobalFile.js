var Opmo = require('./Opmo');

class GlobalFile extends Opmo {
  constructor(data){
    super(data);
  }
  generate(){
    var content = "";
    content += this.genUtility();
    content += this.genTimeSignature();
    super.exportFile(content);
  }
  genTimeSignature(){
    var time = this.content.time;
    var ret = '(setf t-sig (get-time-signature \'(';
    for(var i = 0; i < time.length; i++){
      var _this = String(time[i]);
      ret += `(${_this})`;
    }
    ret += ')))';
    return ret;
  }
  genUtility(){
    var util =
`
(defun renda (pitch unit count)
  (let '(ret nil) '(ret-p nil) '(ret-len nil)
    (setf ret-p (gen-repeat count pitch))
    (setf ret-len (length-adjust '(w) (span ret-p unit) ))
    (setf ret (make-omn :pitch ret-p :length ret-len :articulation '(stacc) :velocity '(pp)))
    (return-from renda ret)
  )
)
(setf test-renda (renda 'd6 '(5e) 8))

`;
    return util;
  }
}

module.exports = GlobalFile;
